<html>
    <head>
        <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
        <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    </head>
<body style="margin:3em;">
<h1>Medical Record</h1>
    Select ICD:
    <select id="ICD" name="ICD" style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;">
        <option value="NFB29">NFB29 Primär total höftledsplastik utan cement</option>
        <option value="NFB49">NFB49 Primär total höftledsplastik med cement</option>
        <option value="NGB49">NGB49 Primär totalprotes i knäled med cement</option>
        <option value="ABC99">ABC99 Dekompressiva operationer på ryggmärgen och nervrötter</option>
    </select>
    <button id="select-button" type="submit" pys-onClick="select_function" style="border-color:#000;border-width:1px;"/>OK</button>

<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >


    <div>Type in date input here</div>
    <input style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="indate-input" />

    <div>Type out dateinput here</div>
    <input style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="outdate-input" style="border-color:#000;border-width:1px;"/>

    <div>Type op date input here</div>
    <input style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="opdate-input" style="border-color:#000;border-width:1px;"/>

    <div>Type type input here</div>
    <input style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="type-input" style="border-color:#000;border-width:1px;"/>

    <div>Type side input here</div>
    <select style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" id="side-input">
        <option value="höger sida">höger sida</option>
        <option value="vänster sida">vänster sida</option>
        <option value="båda sidor">båda sidor</option>
    </select>

    <div>Type ward input here</div>
    <input style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="ward-input" style="border-color:#000;border-width:1px;"/>

    <button id="submit-button" type="submit" pys-onClick="submit_function" style="border-color:#000;border-width:1px;">OK</button>
    <hr style="border:1em;">
    <div id="output"></div>
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<b>Läkemdel</b><br>
<div id="pharma-list"></div>


<textarea name="Text1" cols="40" rows="5" style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="pharma-raw"> </textarea>
<br>
<button id="translate" type="submit" pys-onClick="translate_function" style="border-color:#000;border-width:1px;">translate</button>    
<br>
<div style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee; " id="pharma-fine">    </div>

<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<b>Plan</b>
<div id="plan"></div>
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" >
<b>Epikris</b>
<div id="epikris"></div>
    <py-env>
    </py-env>
    <py-script>
    from js import console
    from datetime import date
    from datetime import timedelta

    ICd = str("")
    indate = str("")
    outdate = str("")
    opdate = str("")
    type = str("")
    side = str("")
    ward = str("")
    pharma = str("")
    pharma_entire = str("")

    today = date.today()
    yesterday = today - timedelta(days = 1)

    def translate_function(*args, **kwargs):        
        finelist = list()
        fineitem = ""
        subfineitem = ""
        finestring = ""
        raw = Element('pharma-raw').element.value
        rawlist = raw.split("\n")
        for rawitem in rawlist:
            prerawlist = list()
            if "Tiden har" in rawitem :
                prerawlist = rawitem.split("Tiden har")
            else:
                prerawlist = rawitem.split("  ")
            
            rawitemlist = prerawlist[0]
            rawl = rawitemlist.split(",")
            newitem = ""
            newlist = ""
            for idx, subitem in enumerate(rawl):
                if idx == 0 :
                    subl = subitem.split(" ")
                    newitem = subl[0]
                if idx == 3 :
                    newitem = newlist.replace('tablett ', 'x ')
                    newitem = newlist.replace('kapsel ', 'x ')
                else:
                    newitem = subitem   
                newlist += newitem
            newlist = newlist.replace('gånger ', '')
            newlist = newlist.replace('dagligen ', '')        
            newlist = newlist.replace('tills vidare', 'tv')
            newlist = newlist.replace('vid behov', 'vb')        
        
            finestring += newlist + "\n"
        #finelist.clear()
        Element('pharma-fine').element.innerText = (finestring)
        
        
    def select_function(*args, **kwargs):

        console.log(f'args: {args}')
        console.log(f'kwargs: {kwargs}')
        global ICD
        global indate 
        global outdate 
        global opdate 
        global type 
        global side 
        global ward     


        ICD = Element('ICD').element.value        
        if ICD == "NFB29" :
            pharma_pat = ("Cilaxoral 7,5mg/ml 10 droppar i 1 vecka. Förebygger förstoppning.\nEliquis 2,5mg 1 tablett 2 gånger dagligen i 30 dagar. Förebygger blodproppar.\nOmeprazol 20mg 1 tablett 1 gång dagligen i 2 veckor. Magskyddande.\nOxynorm 5mg 1 vid behov, max 4 per dag. Smärtlindrande.\nParacetamol 500mg 2 tabletter 3 gånger dagligen i 4 veckor. Smärtlindrande.\n")
            pharma = ("Cilaxoral 7,5mg/ml 10 droppar i 1 vecka.\nEliquis 2,5mg 1x2 i 30 dagar.\nOmeprazol 20mg 1x1 i 2 veckor. \nOxynorm 5mg 1vb, max 4 per dag.\nParacetamol 500mg 2x3 i 4 veckor.\n")
            #pharma = "Enligt medicinlistan"
            Element('type-input').element.value = "primär total höftledsplastik utan cement"
            Element('ward-input').element.value = "78"
            Element('pharma-list').element.innerText = pharma_pat
            Element('plan').element.innerText = ("Sårkontroll om 14 dagar.\nTelefonkontakt med operatören om 4 månader.")
            Element('epikris').element.innerText = ("Ansvarig läkare:\nInskrivningsdatum:\n%s\n\nUtskrivningsdatum:\n%s\n\nVårdsammanfattning:\nHöftledsplastik %s och mobilisering utförd.\n\nUppmärksamhetssignal:\nKontrollerad\n\nBedömning:\nPatienten skrivs ut med pharmakologisk behandling. Bedöms kunna återgå till habitualtillstånd inom 4 månader. \n\nPlanering:\nSårkontroll om 14 dagar. Telefonkontakt med operatör om 4 månader.\n\nLäkemedel\n%s\n\nICD\nM161\n%s\n\n" %(indate, outdate, side, pharma, ICD))
        if ICD == "NFB49" :
            pharma_pat = ("Cilaxoral 7,5mg/ml 10 droppar i 1 vecka. Förebygger förstoppning.\nEliquis 2,5mg 1 tablett 2 gånger dagligen i 30 dagar. Förebygger blodproppar.\nOmeprazol 20mg 1 tablett 1 gång dagligen i 2 veckor. Magskyddande.\nOxynorm 5mg 1 vid behov, max 4 per dag. Smärtlindrande.\nParacetamol 500mg 2 tabletter 3 gånger dagligen i 4 veckor. Smärtlindrande.\n")
            pharma = "Enligt medicinlistan"
            Element('type-input').element.value = "primär total höftledsplastik med cement"
            Element('ward-input').element.value = "78"
            Element('pharma-list').element.innerText = pharma_pat
            Element('plan').element.innerText = ("Sårkontroll om 14 dagar.\nTelefonkontakt med operatören om 3 månader.")
            Element('epikris').element.innerText = ("Ansvarig läkare:\nInskrivningsdatum:\n%s\n\nUtskrivningsdatum:\n%s\n\nVårdsammanfattning:\nHöftledsplastik %s och mobilisering utförd.\n\nUppmärksamhetssignal:\nKontrollerad\n\nBedömning:\nPatienten skrivs ut med pharmakologisk behandling. Bedöms kunna återgå till habitualtillstånd inom 4 månader. \n\nPlanering:\nSårkontroll om 14 dagar. Telefonkontakt med operatör om 3 månader.\n\nLäkemedelslista\n%s\n\nNyinsatta läkemedel\n%s\n\nICD\nM161\n%s\n\n" %(indate, outdate, side, pharma, pharma_entire, ICD))
        if ICD == "NGB49" :
            pharma_pat = ("Etoricoxib 120mg 1 tablett 1 gånger dagligen i 5 dagar. Mot smärta.\nCilaxoral 7,5mg/ml 10 droppar i 1 vecka. Förebygger förstoppning.\nEliquis 2,5mg 1 tablett 2 gånger dagligen i 20 dagar. Förebygger blodpropp.\nOmeprazol 20mg 1 tablett 1 gång dagligen i 2 veckor. Magskyddande.\nOxynorm 5mg 1 vid behov, max 4 dagligen, i 2 veckor. Smärtlindrande.\nParacetamol 500mg 2 tabletter 3 gånger dagligen i 4 veckor. Smärtlindrande. ")
            pharma = "Enligt medicinlistan"
            Element('type-input').element.value = "primär totalprotes i knäled med cement"
            Element('ward-input').element.value = "78"
            Element('pharma-list').element.innerText = pharma_pat
            Element('plan').element.innerText = ("")
            Element('epikris').element.innerText = ("Ansvarig läkare:\nInskrivningsdatum:\n%s\n\nUtskrivningsdatum:\n%s\n\nVårdsammanfattning:\nHöftledsplastik %s och mobilisering utförd.\n\nUppmärksamhetssignal:\nKontrollerad\n\nBedömning:\nPatienten skrivs ut med pharmakologisk behandling. Bedöms kunna återgå till habitualtillstånd inom 4 månader. \n\nPlanering:\nSårkontroll om 14 dagar. Telefonkontakt med operatör om 4 månader.\n\nLäkemedel\n%s\n\nICD\nM161\n%s\n\n" %(indate, outdate, side, pharma, ICD))
        if ICD == "ABC99" :
            pharma_pat = ("Arcoxia120mg 1 tablett 1 gånger dagligen i 6 dagar. Mot smärta.\nCilaxoral 7,5mg/ml 10 droppar i 1 vecka. Förebygger förstoppning.\nOmeprazol 20mg 1 tablett 1 gång dagligen i 10 dagar. Magskyddande.\nOxynorm 5mg 1 vid behov, max 4 dagligen, i 2 veckor. Smärtlindrande.\nParacetamol 500mg 2 tabletter 3 gånger dagligen i 4 veckor. Smärtlindrande. ")
            pharma = "Enligt medicinlistan"
            Element('type-input').element.value = "dekompression av ryggmärgen och nervrötter"
            Element('ward-input').element.value = "78"
            Element('pharma-list').element.innerText = pharma_pat
            Element('plan').element.innerText = ("Sårkontroll om 2 veckor. Sjukgymnast 2 månader. Telefonsamtal med operator 2 månader.")
            side = ""
            Element('epikris').element.innerText = ("Ansvarig läkare:\nInskrivningsdatum:\n%s\n\nUtskrivningsdatum:\n%s\n\nVårdsammanfattning:\nDekompression av nervrötter och ryggmärg samt mobilisering utförd.\n\nUppmärksamhetssignal:\nKontrollerad\n\nBedömning:\nPatienten skrivs ut med pharmakologisk behandling. Bedöms kunna återgå till habitualtillstånd inom 4 månader. \n\nPlanering:\nSårkontroll om 14 dagar. Remiss skickas till sjukgymnast. Telefonkontakt med operatör om 2 månader.\n\nLäkemedel\n%s\n\nICD\nMM488K\n%s\n\n" %(indate, outdate, side, pharma, ICD))
        Element('indate-input').element.value = (str(yesterday))
        Element('indate-input').element.value = (str(yesterday))
        Element('opdate-input').element.value = (str(yesterday))
    def submit_function(*args, **kwargs):
        global ICD 
        global indate 
        global outdate 
        global opdate 
        global type 
        global side 
        global ward 

        #print('args:', args)
        #print('kwargs:', kwargs)

        console.log(f'args: {args}')
        console.log(f'kwargs: {kwargs}')
    
        indate = Element('indate-input').element.value
        outdate = Element('outdate-input').element.value
        opdate = Element('opdate-input').element.value
        type = Element('type-input').element.value
        if ICD == "ABC99" :
            side=""
        else:
            side = Element('side-input').element.value
        ward = Element('ward-input').element.value
        #print('indate:', indate)
        console.log(f'indate: {indate}')
        console.log(f'outdate: {outdate}')
        console.log(f'opdate: {opdate}')
        console.log(f'type: {type}')
        console.log(f'side: {side}')
        console.log(f'ward: {ward}')
        Element('output').element.innerText = ("Du inkom %s till ortopeden Arvika sjukhus för %s %s som opererades %s. Operationen var komplikationsfri och efter operationen har du mått väsentligen bra. Du är adekvat smärtlindrad och har kunnat mobiliseras bra med sjukgymnast på avdelningen. Du anses vara utskrivningsklar från avdelning %s." % (indate, type, side, opdate, ward))

    #print("Du inkom %s till ortopeden Arvika sjukhus för %s %s sida som opererades in den %s. Operationen var komplikationsfri och efter operationen har du mått väsentligen bra. Du är adekvat smärtlindrad och har kunnat mobiliseras bra med sjukgymnast på avdelningen. Du anses tillsammans med oss vara utskrivningsklar från avdelning %s." % (indate, type, side, opdate, ward))

    </py-script>
</body>
</html>
