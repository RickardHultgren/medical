<html>
<head>
    <head>
        <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
         <script defer src="https://pyscript.net/alpha/pyscript.js"></script>

		<link rel="stylesheet" href="styles.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Signika+Negative:300,400,600,700&amp;lang=en" />	
    <script src="//d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js"></script>
    <script src="https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js"></script>

		<script type="text/javascript"
			src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.7.3/brython.min.js">
		</script>		
		<script type="text/javascript"
			src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.7.3/brython_stdlib.js">
	</script>		
<script type="text/python" src="lympha.py"></script>
			
    </head>
<body style="margin:3em;">
<h1 style="font-style:bold;font-size:2em;font-style:serif;">COSMIC-LYMPHA<br>För uträkning av vidarehandläggning baserat på LYMPHA-skript och lab-svar från COSMIC</h1>
<hr style="margin:0em 0em 1.5em 0em;border-color:#888;border-width:1px;background-color:#eeeeee;" >
Markera läkemdlentyperna av prov till vänster i lab-svars-modulen i COSMIC. Tryck Ctrl + C. Sätt markören i rutan "Provtyper" och trycka på Ctrl + V. Klicka sedan någonstans r tabellen med provsvar. Tryck sedan Ctrl + A och därefter Ctrl + C. Sätt markören i rutan "Provsvar" och trycka på Ctrl + V. Tryck sedan på knappen "Kalkylera".
<hr style="margin:0em 0em 1.5em 0em;border-color:#888;border-width:1px;background-color:#eeeeee;" >
<br>
<br>
Provtyper
<br>
<textarea cols="100" rows="10" style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="heads"> </textarea>
<br>
<br>
Provsvar
<br>
<textarea cols="100" rows="10" style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" type="text" id="thedata"> </textarea>
<br>

	<button id="calcbttn" type="submit" pys-onClick="calculate">
		Kalkylera
	</button>

<div id="assessment"></div>
	
<hr style="margin:0em 0em 1.5em 0em;border-color:#000;border-width:1px;background-color:#eeeeee;" />
				<form id="steps">
				
				  <b>Number of steps that should be taken:</b><br>
				  
				
				</form>
    <py-env>
    #- re
    </py-env>
    <py-script>
    from js import console
    def calculate(*args, **kwargs): 
        Element('assessment').element.innerText = ("test 1")
        headrows = list() 
        datarows = list()
        heads = str(Element('heads').element.value)
        headrows = heads.split("\n")
        thedata = str(Element('thedata').element.value)
        datarows = thedata.split("\n")
        rowspec = dict()
        rowsdata = dict()
        title = str()
        max = 0 
        min = 0
        #For data specifications:
        for rowidx, row in enumerate(headrows):
            title = str()
            intervall = str()
            Element('assessment').element.innerText = ("test 2")
            try:
              while row[0] == " " :
                row = row[1:]
                if row[0] != " " :
                    break
            except:
              pass
            Element('assessment').element.innerText = ("test 2.1")
            rowlist = row.split("\t")
            specific = dict()
            for idx, subitem in enumerate(rowlist):
                if idx == 0 :
                    title = subitem
                    specific["title"] = title
                if idx == 2 :
                  try:
                    intervall = subitem 
                    ilist = intervall.split("-")
                    specific["norm_min"] = int(ilist[0])
                    specific["norm_max"] = int(ilist[1])  
                  except:
                    pass
            rowspec[str(rowidx)] = specific                
            Element('assessment').element.innerText = ("test 2.2")
        #For table data:
        Element('assessment').element.innerText = ("test 2.3")
        for rowidx, row in enumerate(datarows):
            Element('assessment').element.innerText = ("test 3")
            try:
              while row[0] == " " :
                row = row[1:]
                if row[0] != " " :
                    break
            except:
              pass
            rowlist = row.split("\t")		

            for subitem in rowlist:
                done = 0
                if subitem == "" :
                    if done == 1 :
                        break
                    else:
                        pass
                else:
                    rowsdata[str(rowidx)]  = subitem            
                    done = 1
        Element('assessment').element.innerText = ("test 3.1")
        #Assessment:
        toprint = str()
        thestarts = document.querySelector('#thestarts')
        Element('assessment').element.innerText = ("test 3.2")
        for i in range(len(rowspec)):
            #try:
            Element('assessment').element.innerText = ("test 3.3")
            j = int(int(i))
            specific = rowspec[str(j)]
            #number = str(rowsdata[str(i)])
            #number = number.replace(" ", "")
            evaluation = str()
            Element('assessment').element.innerText = ("test 3.4")
            try:
              title = str(specific["title"])
              min = int(specific["norm_min"])
              max = int(specific["norm_max"])
            except:
              pass
            Element('assessment').element.innerText = ("test 3.5")
            try:
              intnumber = int(rowsdata[str(i)]) 
            except:
              pass
            Element('assessment').element.innerText = ("test 3.6")
            try:
              if   intnumber < min :
                evaluation="too low"
              elif intnumber > max :
                evaluation="too high"
								
              else:
                evaluation="normal"

            except:
              pass
            try:
              start_element = document.createElement("input")
              start_element.textContent = title
              start_element.className = "theStarts"
              thestarts.appendChild( start_element )            

            except:
              pass
            toprint = toprint + title + " ; min: " + str(min) + " ; max: " + str(max) + " ; value: " + str(intnumber) + " ; " + evaluation + "\n"
            #except:
            #pass


            Element('assessment').element.innerText = ("test 4")
							
        Element('assessment').element.innerText = (str(toprint))

        for i in range(len(rowspec)):
            #try:
            j = int(int(i))
            specific = rowspec[str(j)]
            #number = str(rowsdata[str(i)])
            #number = number.replace(" ", "")
            evaluation = str()
            title = str(specific["title"])
            min = int(specific["norm_min"])
            max = int(specific["norm_max"])
            intnumber = int(rowsdata[str(i)]) 
            if   intnumber < min :
                evaluation="too low"
            elif intnumber > max :
                evaluation="too high"
            else:
                evaluation="normal"
            Element('assessment').element.input = (str(title))

    </py-script>
		<script type="text/python">
			from browser import document, bind, html, alert, window
			import lympha
		</script>  

			<div style="content">

		<div style="content">
			<p class="container" style="">		
		

				<!--img src="logo.png" style="width:25vw;">
				<h1>LYMPHA-online</h1-->
				<br>
				<br>

				
				<br><br>

				<!--form>
					<input type="radio" name="arg" value="" />Let the value of variables decide paths to be shown.<br>
					<input type="radio" name="arg" value="" />Let all the paths available be shown.<br>
				</form-->
				<!--br>
				<br-->
				<!--form>
					<input type="radio" name="out" value="" />Graph output.<br>
					<input type="radio" name="out" value="" />Step output.<br>
				</form-->	
				<b>Start nodes:</b>
				<form id="thestarts">
				  <input type="text" class="theStarts"/><br>
				</form>
				<button id="addstart" >Add yet another start node</button><br>
				
				<br>
				<br>

				<form id="steps">
				
				  <b>Number of steps that should be taken:</b><br>
				  <input type="text" id="stepNr" class="stepNr"/><br>
				
				</form>
				
				<br>
				<br>

				<button id="zcriptbttn">Check for variable factors</button><br>
				
				<hr style="width:50vw; right:25vw; z-index:1;position:relative; text-align:center;" />

				<form id="factorlist">
				  <input type="text" style="hidden" class="factorItems"></input>
				</form>
				<button id="turn2">Implement variables into script</button><br>
				<hr style="width:50vw; right:25vw; z-index:1;position:relative; text-align:center;" />
				<span style="color:black;"><b>Result:</b><br></span>
				<form id="resultlist">
				  
				</form>
			</p>
		</div>



  
<div id="graphpreview" style="width: 900px; height: 900px; border: 1px solid black; backgroundColor:#ff0000"></div>

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>v

<div id="graph" style="width: 300px; height: 300px; border: 1px solid black; backgroundColor:#ff0000"></div>

	<script id="js">
 
    //d3.select("#graph").graphviz().renderDot("digraph {a -> c}");
    //d3.select("#graph").graphviz().renderDot('digraph {a -> c ; a -> b}');
	</script>

			
		
<br><br>


</body>
</html>
